<script setup lang="ts">
import { BIconStar, BIconStarFill } from "bootstrap-icons-vue";
import { ref, watch } from "vue";

const props = defineProps({
  rating: {
    type: Number,
    required: true,
  },
});
const rating = ref(props.rating || 0);
const isResetting = ref(false);
const hoverRating = ref(0);
const emits = defineEmits(["event:change"]);

const onHover = (value: number) => {
  if (isResetting.value) {
    return;
  }
  hoverRating.value = value;
};

const onHoverLeave = () => {
  hoverRating.value = 0;
  isResetting.value = false;
};

const onClick = (value: number) => {
  let latestRating = value;
  if (latestRating === rating.value) {
    latestRating = 0;
    isResetting.value = true;
  }
  emits("event:change", latestRating);
};

watch(props, (props, prevProps) => {
  rating.value = props.rating;
  hoverRating.value = 0;
});
</script>

<template>
  <div class="flex text-xs space-x-1 mt-1">
    <BIconStarFill
      :id="`rating-${n}-btn`"
      @click="onClick(n)"
      v-for="n in rating"
    />
    <div
      :id="`rating-${n}-btn`"
      @click="onClick(n + rating)"
      v-for="n in 5 - rating"
    >
      <BIconStar
        :class="n + rating <= hoverRating ? 'hidden' : 'block'"
        v-on:mouseover="onHover(n + rating)"
        v-on:mouseleave="onHoverLeave"
      />
      <BIconStarFill
        :class="n + rating <= hoverRating ? 'block' : 'hidden'"
        v-on:mouseover="onHover(n + rating)"
        v-on:mouseleave="onHoverLeave"
      />
    </div>
  </div>
</template>
